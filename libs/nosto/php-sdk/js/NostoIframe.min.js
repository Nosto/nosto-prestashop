if("undefined"==typeof Nosto)var Nosto={};Nosto.iframe=function(a){function b(a){var b=new RegExp(k.origin);if(b.test(a.origin)&&"[Nosto]"===(""+a.data).substr(0,7)){var d=(""+a.data).substr(7),e=JSON.parse(d);if("object"==typeof e&&e.type)switch(e.type){case g:c(k.urls.createAccount,{data:{email:e.params.email},success:function(a){var b=JSON.parse(a.target.response);if(!b.redirect_url)throw new Error("Nosto: failed to handle account creation.");f().src=b.redirect_url}});break;case h:c(k.urls.connectAccount,{success:function(a){var b=JSON.parse(a.target.response);if(!b.redirect_url)throw new Error("Nosto: failed to handle account connection.");b.success&&b.success===!0?window.location.href=b.redirect_url:f().src=b.redirect_url}});break;case i:c(k.urls.syncAccount,{success:function(a){var b=JSON.parse(a.target.response);if(!b.redirect_url)throw new Error("Nosto: failed to handle account sync.");b.success&&b.success===!0?window.location.href=b.redirect_url:f().src=b.redirect_url}});break;case j:c(k.urls.deleteAccount,{success:function(a){var b=JSON.parse(a.target.response);if(!b.redirect_url)throw new Error("Nosto: failed to handle account deletion.");f().src=b.redirect_url}});break;default:throw new Error("Nosto: invalid postMessage `type`.")}}}function c(a,b){var c=d({method:"POST",async:!0,data:{}},b);d(c.data,k.xhrParams);var f=e(c.data),g=new XMLHttpRequest;"function"==typeof c.success&&g.addEventListener("load",c.success,!1),"function"==typeof c.error&&g.addEventListener("error",c.error,!1),g.open(c.method,decodeURIComponent(a),c.async),g.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(f)}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function e(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(""!==b&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b}function f(){return document.getElementById(k.iframeId)}var g="newAccount",h="connectAccount",i="syncAccount",j="removeAccount",k={origin:"",iframeId:"nosto_iframe",urls:{createAccount:"",connectAccount:"",syncAccount:"",deleteAccount:""},xhrParams:{}};d(k,a),window.addEventListener("message",b,!1)};